import{_ as e,r as o,o as c,c as i,a as n,b as s,d as t,e as p}from"./app-4d1d3ef4.js";const l="/vuepress_blog/assets/微信公众号安全域名设置-389f2267.png",u="/vuepress_blog/assets/微信SDK服务器白名单设置-a2aa761c.png",r={},k=n("h2",{id:"申请微信测试账号",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#申请微信测试账号","aria-hidden":"true"},"#"),s(" 申请微信测试账号")],-1),d=n("li",null,[s("修改本地 host 文件：windows 路径 "),n("code",null,"C:\\Windows\\System32\\drivers\\etc"),s(",将本地 host 改为任意域名，比如"),n("code",null,"tumbleweed.top")],-1),v={href:"https://mp.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},m=n("code",null,"开发-开发者工具-公众平台测试账号",-1),b=n("li",null,[s("在 "),n("code",null,"JS接口安全域名修改"),s(" 中配置自定义的本地域名 "),n("code",null,"tumbleweed.top")],-1),g=n("li",null,"关注测试号二维码 （如果多人开发，都要关注这个测试账号）",-1),y=p(`<h2 id="安装手机代理软件-废弃不用-直接使用内网穿透" tabindex="-1"><a class="header-anchor" href="#安装手机代理软件-废弃不用-直接使用内网穿透" aria-hidden="true">#</a> 安装手机代理软件 (废弃不用：直接使用内网穿透)</h2><p>由于我们的域名是自定义的假域名，并不存在，所以需要将手机的网络代理到电脑上，由电脑端向微信服务器发送请求</p><h3 id="安装-charles-并测试-废弃不用-直接使用内网穿透" tabindex="-1"><a class="header-anchor" href="#安装-charles-并测试-废弃不用-直接使用内网穿透" aria-hidden="true">#</a> 安装 charles 并测试 (废弃不用：直接使用内网穿透)</h3><p>charles 是一款收费软件，下载安装之后，在 <code>proxy-setting</code> 中查看 http 代理端口，默认是 <code>8888</code>,将手机和电脑接入统一局域网中，打开手机 WiFi 连接，配置手动代理，输入电脑的 IP 地址和代理端口 <code>8888</code></p><p>在电脑上启动本地调试服务，注意要运行在 80 端口下面，微信 sdk 只支持(http 80 或者 https 443),比如运行在 <code>http://tumbleweed.top</code>,如果使用的是 vue 开发，需要在<code>vue.config.js</code>中配置以下字段</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>   devServer: {
       disableHostCheck: true,
       port:80,
       host:&#39;tumbleweed.top&#39;
   }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在手机上访问 <code>http://tumbleweed.top</code>,如果能访问成功，则表明代理软件已经配置成功（注意 charles 会弹出确认代理连接操作弹框）</p><h2 id="服务端代码" tabindex="-1"><a class="header-anchor" href="#服务端代码" aria-hidden="true">#</a> 服务端代码</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;request&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;axios&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> sha1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;js-sha1&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 引入sha1加密算法，需要使用sha1算法生成签名</span>
<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;koa&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;koa2-cors&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> serve <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-static&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>appId<span class="token punctuation">,</span> appSecret<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./wechatSetting&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@koa/router&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;koa-bodyparser&#39;</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">serve</span><span class="token punctuation">(</span><span class="token string">&quot;./static&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 测试接口</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/wechat/hello&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;Hello World&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 微信 SDK 初始化</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/wechat/sdkInit&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body
    <span class="token keyword">const</span> url <span class="token operator">=</span> ctx<span class="token punctuation">.</span>body<span class="token punctuation">.</span>url <span class="token comment">// 初始化jsdk的页面url，如果是单页应用记得截掉url的#部分</span>
    <span class="token keyword">let</span> access_token <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
    <span class="token keyword">let</span> ticket <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> step1Res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
            <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>appId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;secret=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>appSecret<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span>
        <span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>step1Res<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            access_token <span class="token operator">=</span> step1Res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>access_token
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> step2Res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
            <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>access_token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;type=jsapi</span><span class="token template-punctuation string">\`</span></span>
        <span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>step2Res<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ticket <span class="token operator">=</span> step2Res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>ticket
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> <span class="token function-variable function">createNonceStr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token function-variable function">createTimeStamp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;&#39;</span>
        <span class="token keyword">const</span> <span class="token function-variable function">calcSignature</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ticket<span class="token punctuation">,</span> nonceStr<span class="token punctuation">,</span> ts<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">jsapi_ticket=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ticket<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;noncestr=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>nonceStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;timestamp=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ts<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;url=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span>
            <span class="token keyword">return</span> <span class="token function">sha1</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token comment">//使用sha1加密算法</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> nonceStr <span class="token operator">=</span> <span class="token function">createNonceStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 随机字符串</span>
        <span class="token keyword">const</span> timestamp <span class="token operator">=</span> <span class="token function">createTimeStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 时间戳</span>
        <span class="token keyword">const</span> signature <span class="token operator">=</span> <span class="token function">calcSignature</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span> nonceStr<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> url<span class="token punctuation">)</span> <span class="token comment">// 通过sha1算法得到签名</span>
        ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">result</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">nonceStr</span><span class="token operator">:</span> nonceStr<span class="token punctuation">,</span>
                <span class="token literal-property property">timestamp</span><span class="token operator">:</span> timestamp<span class="token punctuation">,</span>
                <span class="token literal-property property">signature</span><span class="token operator">:</span> signature<span class="token punctuation">,</span>
                appId<span class="token punctuation">,</span>
                <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;签名获取成功&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> res
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 微信授权登录接口测试</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/wechat/sendCode&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query
    <span class="token keyword">const</span> code <span class="token operator">=</span> query<span class="token punctuation">.</span>code
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getAccessCodeFromCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>access_token<span class="token punctuation">,</span> openid<span class="token punctuation">}</span> <span class="token operator">=</span> data
        <span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token literal-property property">data</span><span class="token operator">:</span> userInfo<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserInfoFromWechat</span><span class="token punctuation">(</span>access_token<span class="token punctuation">,</span> openid<span class="token punctuation">)</span>
        ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">result</span><span class="token operator">:</span> userInfo<span class="token punctuation">,</span>
            <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;用户信息获取成功&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> res
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 小程序获取openid</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/wechat/getOpenid&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;post /wechat/getOpenid&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query
    <span class="token keyword">const</span> code <span class="token operator">=</span> query<span class="token punctuation">.</span>code
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getAccessCodeFromCodeByMiniProgram</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111111</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>session_key<span class="token punctuation">,</span> openid<span class="token punctuation">}</span> <span class="token operator">=</span> data
        ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">result</span><span class="token operator">:</span> <span class="token punctuation">{</span>session_key<span class="token punctuation">,</span>openid<span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;openid 获取成功&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> res
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;response:&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 微信公众平台调用接口</span>
<span class="token keyword">function</span> <span class="token function">getAccessCodeFromCode</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">CODE</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">https://api.weixin.qq.com/sns/oauth2/access_token?appid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>appId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;secret=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>appSecret<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;code=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">CODE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;grant_type=authorization_code</span><span class="token template-punctuation string">\`</span></span>
    <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 小程序登录调用接口 获取openid</span>
<span class="token keyword">function</span> <span class="token function">getAccessCodeFromCodeByMiniProgram</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">CODE</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">https://api.weixin.qq.com/sns/jscode2session?appid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>appId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;secret=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>appSecret<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;js_code=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">CODE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;grant_type=authorization_code</span><span class="token template-punctuation string">\`</span></span>
    <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">validateToken</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">ACCESS_TOKEN</span><span class="token punctuation">,</span> <span class="token constant">OPENID</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">https://api.weixin.qq.com/sns/auth?access_token=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ACCESS_TOKEN</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;openid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">OPENID</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span>
    <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">refreshToken</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">REFRESH_TOKEN</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">https://api.weixin.qq.com/sns/oauth2/refresh_token?appid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>appId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;grant_type=refresh_token&amp;refresh_token=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">REFRESH_TOKEN</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span>
    <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getUserInfoFromWechat</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">ACCESS_TOKEN</span><span class="token punctuation">,</span> <span class="token constant">OPENID</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">https://api.weixin.qq.com/sns/userinfo?access_token=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ACCESS_TOKEN</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;openid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">OPENID</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;lang=zh_CN</span><span class="token template-punctuation string">\`</span></span>
    <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;app is running in port 5000&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="前端代码" tabindex="-1"><a class="header-anchor" href="#前端代码" aria-hidden="true">#</a> 前端代码</h2><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>所有需要使用 JS-SDK 的页面必须先注入配置信息，否则将无法调用.（同一个 url 仅需调用一次，对于变化 url 的 SPA 的 web app 可在每次 url 变化时进行调用),url（当前网页的 URL，不包含#及其后面部分）</p><p>以微信扫一扫功能为例，每个需要调用扫一扫的页面需要先初始化 SDK，调用后台生成签名接口时需要传入前页面的 url</p></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div @click<span class="token operator">=</span><span class="token string">&quot;menuClick&quot;</span><span class="token operator">&gt;</span>扫一扫<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token constant">WX</span> <span class="token keyword">from</span> <span class="token string">&quot;weixin-js-sdk&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>getWXconfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/src/api/wx.js&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">initWx</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getWXconfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 获取 appId timestamp nonceStr signature</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">configWX</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">menuClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initWx</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">startScanCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token constant">WX</span><span class="token punctuation">.</span><span class="token function">scanQRCode</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">needResult</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 默认为0，扫描结果由微信处理，1则直接返回扫描结果，</span>
        <span class="token literal-property property">scanType</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;qrCode&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 可以指定扫二维码还是一维码，默认二者都有</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 扫一扫返回的结果</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">configWX</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token constant">WX</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">debug</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</span>
        <span class="token literal-property property">appId</span><span class="token operator">:</span> data<span class="token punctuation">.</span>appId<span class="token punctuation">,</span> <span class="token comment">// 必填，公众号的唯一标识</span>
        <span class="token literal-property property">timestamp</span><span class="token operator">:</span> data<span class="token punctuation">.</span>timestamp<span class="token punctuation">,</span> <span class="token comment">// 必填，生成签名的时间戳</span>
        <span class="token literal-property property">nonceStr</span><span class="token operator">:</span> data<span class="token punctuation">.</span>nonceStr<span class="token punctuation">,</span> <span class="token comment">// 必填，生成签名的随机串</span>
        <span class="token literal-property property">signature</span><span class="token operator">:</span> data<span class="token punctuation">.</span>signature<span class="token punctuation">,</span> <span class="token comment">// 必填，签名</span>
        <span class="token literal-property property">jsApiList</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 必填，需要使用的JS接口列表</span>
          <span class="token string">&#39;checkJsApi&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;onMenuShareTimeline&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;onMenuShareAppMessage&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;onMenuShareQQ&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;onMenuShareWeibo&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;onMenuShareQZone&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;hideMenuItems&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;showMenuItems&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;hideAllNonBaseMenuItem&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;showAllNonBaseMenuItem&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;translateVoice&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;startRecord&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;stopRecord&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;onVoiceRecordEnd&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;playVoice&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;onVoicePlayEnd&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;pauseVoice&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;stopVoice&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;uploadVoice&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;downloadVoice&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;chooseImage&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;previewImage&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;uploadImage&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;downloadImage&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;getNetworkType&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;openLocation&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;getLocation&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;hideOptionMenu&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;showOptionMenu&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;closeWindow&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;scanQRCode&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;chooseWXPay&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;openProductSpecificView&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;addCard&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;chooseCard&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;openCard&#39;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token doc-comment comment">/**wx.error可以返回微信config配置是否成功*/</span>
      <span class="token constant">WX</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;WX----error&quot;</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token constant">WX</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;WX----ready&quot;</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
        that<span class="token punctuation">.</span><span class="token function">startScanCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="线上部署配置" tabindex="-1"><a class="header-anchor" href="#线上部署配置" aria-hidden="true">#</a> 线上部署配置</h2><h3 id="js-接口安全域名" tabindex="-1"><a class="header-anchor" href="#js-接口安全域名" aria-hidden="true">#</a> JS 接口安全域名</h3><p>设置需要调用 js-sdk 的 H5 页面 <img src="`+l+'" alt="JS接口安全域名"></p><h3 id="微信-ip-白名单设置" tabindex="-1"><a class="header-anchor" href="#微信-ip-白名单设置" aria-hidden="true">#</a> 微信 IP 白名单设置</h3><p>通过开发者 ID 及密码调用获取 access_token 接口时，需要设置访问来源 IP 为白名单（初始化 js-sdk 的时候需要后台服务器与微信服务器进行交互，获取 access_token,需要添加后台服务器 ip 至微信公众号白名单中）</p><p>目的：为了提高公众平台开发者接口调用的安全性，避免一旦开发者 ID 和密码泄露后给帐号造成损失。对调用“获取 access_token”接口增加 IP 白名单校验：只有将 IP 地址设置为公众号的 IP 白名单，才能成功调用该接口 <img src="'+u+'" alt="JS接口安全域名"></p><h2 id="参考链接" tabindex="-1"><a class="header-anchor" href="#参考链接" aria-hidden="true">#</a> 参考链接</h2>',19),h={href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#1",target:"_blank",rel:"noopener noreferrer"},f={href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#67",target:"_blank",rel:"noopener noreferrer"},w={href:"https://ngrok.com/download",target:"_blank",rel:"noopener noreferrer"},_=p(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># Start a tunnel,将内网 3000 端口映射到外网</span>
ngrok http <span class="token number">3000</span>
<span class="token comment"># 如果需要提供网页服务 需要设置 token</span>
ngrok config add-authtoken <span class="token operator">&lt;</span>token<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),x={href:"https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&t=sandbox/index",target:"_blank",rel:"noopener noreferrer"},q={href:"https://juejin.cn/post/7012484910082441229",target:"_blank",rel:"noopener noreferrer"},S=p(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 前后端分离需要配置 nginx 将前后端都代理到 3000 端口</span>
server <span class="token punctuation">{</span>
    listen       <span class="token number">3000</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

    location /wechat <span class="token punctuation">{</span>
        proxy_pass http://localhost:5000<span class="token punctuation">;</span> <span class="token comment"># 后端接口</span>
    <span class="token punctuation">}</span>
    location / <span class="token punctuation">{</span>
        proxy_pass http://localhost:4000<span class="token punctuation">;</span> <span class="token comment"># 前端页面</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1);function I(C,E){const a=o("ExternalLinkIcon");return c(),i("div",null,[k,n("ul",null,[d,n("li",null,[n("a",v,[s("登录微信公众平台"),t(a)]),s(", 进入 "),m,s(" 申请测试账号")]),b,g]),y,n("ul",null,[n("li",null,[n("a",h,[s("微信 SDK 官方文档"),t(a)])]),n("li",null,[n("a",f,[s("微信 SDK 官方 demo"),t(a)])]),n("li",null,[n("a",w,[s("ngrok 内网穿透工具下载"),t(a)])])]),_,n("ul",null,[n("li",null,[n("a",x,[s("微信测试账号登录地址"),t(a)])]),n("li",null,[n("a",q,[s("10 分钟带你完成微信网页授权&获取用户信息&搭建内网映射测试"),t(a)])])]),S])}const j=e(r,[["render",I],["__file","/home/runner/work/vuepress_blog/vuepress_blog/docs/.vuepress/.temp/pages/wechat/wechat_sdk.html.vue"]]);export{j as default};
